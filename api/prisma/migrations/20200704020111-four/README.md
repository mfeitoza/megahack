# Migration `20200704020111-four`

This migration has been generated by Marcus Feitoza at 7/4/2020, 2:01:11 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
PRAGMA foreign_keys=OFF;

DROP INDEX "quaint"."Tag.name"

CREATE TABLE "quaint"."new_Tag" (
"name" TEXT NOT NULL  ,
    PRIMARY KEY ("name"))

INSERT INTO "quaint"."new_Tag" ("name") SELECT "name" FROM "quaint"."Tag"

PRAGMA foreign_keys=off;
DROP TABLE "quaint"."Tag";;
PRAGMA foreign_keys=on

ALTER TABLE "quaint"."new_Tag" RENAME TO "Tag";

CREATE TABLE "quaint"."new__RequestToTag" (
"A" TEXT NOT NULL  ,"B" TEXT NOT NULL  ,FOREIGN KEY ("A") REFERENCES "Request"("id") ON DELETE CASCADE ON UPDATE CASCADE,
FOREIGN KEY ("B") REFERENCES "Tag"("name") ON DELETE CASCADE ON UPDATE CASCADE)

INSERT INTO "quaint"."new__RequestToTag" ("A", "B") SELECT "A", "B" FROM "quaint"."_RequestToTag"

PRAGMA foreign_keys=off;
DROP TABLE "quaint"."_RequestToTag";;
PRAGMA foreign_keys=on

ALTER TABLE "quaint"."new__RequestToTag" RENAME TO "_RequestToTag";

CREATE UNIQUE INDEX "quaint"."_RequestToTag_AB_unique" ON "_RequestToTag"("A","B")

CREATE  INDEX "quaint"."_RequestToTag_B_index" ON "_RequestToTag"("B")

PRAGMA "quaint".foreign_key_check;

PRAGMA foreign_keys=ON;
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200703225440-one..20200704020111-four
--- datamodel.dml
+++ datamodel.dml
@@ -1,7 +1,7 @@
 datasource DS {
   provider = "sqlite"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider      = "prisma-client-js"
@@ -32,18 +32,17 @@
   response Response[]
 }
 model Tag {
-  id       Int       @id @default(autoincrement())
-  name     String    @unique
+  name     String    @id
   requests Request[] @relation(references: [id])
 }
 model Request {
   id                String              @id @default(cuid())
   title             String
   description       String
-  tags              Tag[]               @relation(references: [id])
+  tags              Tag[]               @relation(references: [name])
   createdAt         DateTime            @default(now())
   company           Company             @relation(fields: [companyId], references: [id])
   companyId         String
   validUntil        DateTime
```


