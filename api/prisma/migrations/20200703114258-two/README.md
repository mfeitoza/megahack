# Migration `20200703114258-two`

This migration has been generated by Marcus Feitoza at 7/3/2020, 11:42:58 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
PRAGMA foreign_keys=OFF;

CREATE TABLE "quaint"."Tag" (
"id" INTEGER NOT NULL  PRIMARY KEY AUTOINCREMENT,"name" TEXT NOT NULL  )

CREATE TABLE "quaint"."ReponsesToRequest" (
"id" TEXT NOT NULL  ,"requestId" TEXT NOT NULL  ,"responseId" TEXT NOT NULL  ,"selected" BOOLEAN NOT NULL DEFAULT false ,"status" TEXT NOT NULL  ,
    PRIMARY KEY ("id"),FOREIGN KEY ("requestId") REFERENCES "Request"("id") ON DELETE CASCADE ON UPDATE CASCADE,
FOREIGN KEY ("responseId") REFERENCES "Response"("id") ON DELETE CASCADE ON UPDATE CASCADE)

CREATE TABLE "quaint"."_RequestToTag" (
"A" TEXT NOT NULL  ,"B" INTEGER NOT NULL  ,FOREIGN KEY ("A") REFERENCES "Request"("id") ON DELETE CASCADE ON UPDATE CASCADE,
FOREIGN KEY ("B") REFERENCES "Tag"("id") ON DELETE CASCADE ON UPDATE CASCADE)

CREATE TABLE "quaint"."new_Request" (
"createdAt" DATE NOT NULL DEFAULT CURRENT_TIMESTAMP ,"createdById" TEXT NOT NULL  ,"description" TEXT NOT NULL  ,"id" TEXT NOT NULL  ,"title" TEXT NOT NULL  ,"validUntil" DATE NOT NULL  ,
    PRIMARY KEY ("id"),FOREIGN KEY ("createdById") REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE)

INSERT INTO "quaint"."new_Request" ("createdAt", "description", "id", "title", "validUntil") SELECT "createdAt", "description", "id", "title", "validUntil" FROM "quaint"."Request"

PRAGMA foreign_keys=off;
DROP TABLE "quaint"."Request";;
PRAGMA foreign_keys=on

ALTER TABLE "quaint"."new_Request" RENAME TO "Request";

CREATE UNIQUE INDEX "quaint"."Tag.name" ON "Tag"("name")

CREATE UNIQUE INDEX "quaint"."_RequestToTag_AB_unique" ON "_RequestToTag"("A","B")

CREATE  INDEX "quaint"."_RequestToTag_B_index" ON "_RequestToTag"("B")

PRAGMA foreign_keys=off;
DROP TABLE "quaint"."Category";;
PRAGMA foreign_keys=on

PRAGMA foreign_keys=off;
DROP TABLE "quaint"."_CategoryToRequest";;
PRAGMA foreign_keys=on

PRAGMA "quaint".foreign_key_check;

PRAGMA foreign_keys=ON;
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200703112659-one..20200703114258-two
--- datamodel.dml
+++ datamodel.dml
@@ -1,7 +1,7 @@
 datasource DS {
   provider = "sqlite"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider      = "prisma-client-js"
@@ -11,44 +11,53 @@
 // Define your own datamodels here and run `yarn redwood db save` to create
 // migrations for them.
 // TODO: Please remove the following example:
 model User {
-  id       String     @id @default(cuid())
-  email    String     @unique
-  name     String
-  company  String
-  zipCode  String
-  address  String
-  state    String
-  city     String
-  request  Request[]
-  response Response[]
+  id        String     @id @default(cuid())
+  email     String     @unique
+  name      String
+  company   String
+  zipCode   String
+  address   String
+  state     String
+  city      String
+  requests  Request[]
+  responses Response[]
 }
-model Category {
-  id      Int       @id @default(autoincrement())
-  name    String
-  request Request[] @relation(references: [id])
+model Tag {
+  id       Int       @id @default(autoincrement())
+  name     String    @unique
+  requests Request[] @relation(references: [id])
 }
 model Request {
-  id          String     @id @default(cuid())
-  title       String
-  description String
-  category    Category[] @relation(references: [id])
-  createdAt   DateTime   @default(now())
-  created     User       @relation(fields: [createdBy], references: [id])
-  createdBy   String
-  validUntil  DateTime
-  response    Response?  @relation(fields: [responseId], references: [id])
-  responseId  String?
+  id                String              @id @default(cuid())
+  title             String
+  description       String
+  tags              Tag[]               @relation(references: [id])
+  createdAt         DateTime            @default(now())
+  createdBy         User                @relation(fields: [createdById], references: [id])
+  createdById       String
+  validUntil        DateTime
+  ReponsesToRequest ReponsesToRequest[]
 }
 model Response {
-  id          String    @id @default(cuid())
-  title       String
-  description String
-  createdAt   DateTime  @default(now())
-  created     User      @relation(fields: [createdBy], references: [id])
-  createdBy   String
-  request     Request[]
+  id                String              @id @default(cuid())
+  title             String
+  description       String
+  createdAt         DateTime            @default(now())
+  created           User                @relation(fields: [createdBy], references: [id])
+  createdBy         String
+  ReponsesToRequest ReponsesToRequest[]
 }
+
+model ReponsesToRequest {
+  id         String   @id @default(cuid())
+  request    Request  @relation(fields: [requestId], references: [id])
+  requestId  String
+  response   Response @relation(fields: [responseId], references: [id])
+  responseId String
+  selected   Boolean  @default(false)
+  status     String
+}
```


